modules:
  - type: files
    files:
      - source: system
        destination: /

  - type: copy
    from: ghcr.io/ublue-os/akmods:main-42-x86_64
    src: /rpms/ublue-os
    dest: /tmp/akmods-rpms

  - type: copy
    from: ghcr.io/ublue-os/akmods:main-42-x86_64
    src: /kernel-rpms
    dest: /tmp/kernel-rpms

  - type: script
    snippets:
      - "mkdir -p /var/roothome"
      - "dnf5 -y swap --repo='fedora' OpenCL-ICD-Loader ocl-icd"
      - "dnf5 config-manager addrepo --from-repofile='https://negativo17.org/repos/fedora-multimedia.repo'"
      - "dnf5 config-manager setopt fedora-multimedia.priority=90"
      
  - type: dnf
    repos:
      cleanup: true
      copr:
        - ublue-os/packages
        - ublue-os/staging
    install:
      packages:
        - /tmp/akmods-rpms/*.rpm
        - ublue-os-just
        - ublue-os-luks
        - ublue-os-signing
        - ublue-os-udev-rules
        - ublue-os-update-services
        - fedora-repos-archive
        - zstd
        - alsa-firmware # ----- taken from https://github.com/ublue-os/main/blob/main/packages.json, START -----
        - android-udev-rules
        - apr
        - apr-util
        - distrobox
        - fdk-aac
        - ffmpeg
        - ffmpeg-libs
        - ffmpegthumbnailer
        - flatpak-spawn
        - fuse
        - fzf
        - google-noto-sans-balinese-fonts
        - google-noto-sans-cjk-fonts
        - google-noto-sans-javanese-fonts
        - google-noto-sans-sundanese-fonts
        - grub2-tools-extra
        - heif-pixbuf-loader
        - htop
        - intel-vaapi-driver
        - just
        - libavcodec
        - libcamera
        - libcamera-gstreamer
        - libcamera-ipa
        - libheif
        - libcamera-tools
        - libfdk-aac
        - libimobiledevice-utils
        - libratbag-ratbagd
        - libva-utils
        - lshw
        - mesa-libxatracker
        - net-tools
        - nvme-cli
        - nvtop
        - openrgb-udev-rules
        - openssl
        - oversteer-udev
        - pam-u2f
        - pam_yubico
        - pamu2fcfg
        - pipewire-libs-extra
        - pipewire-plugin-libcamera
        - powerstat
        - smartmontools
        - solaar-udev
        - squashfs-tools
        - symlinks
        - tcpdump
        - tmux
        - traceroute
        - usbmuxd
        - vim
        - wireguard-tools
        - wl-clipboard
        - xhost
        - xorg-x11-xauth
        - yubikey-manager # ----- taken from https://github.com/ublue-os/main/blob/main/packages.json, END -----
    remove:
      packages:
        - fedora-flathub-remote
        - google-noto-sans-cjk-vf-fonts
        - default-fonts-cjk-sans
    replace:
      - from-repo: fedora-multimedia
        skip-unavailable: true
        packages:
          - intel-gmmlib
          - intel-mediasdk
          - intel-vpl-gpu-rt
          - libheif
          - libva
          - libva-intel-media-driver
          - mesa-dri-drivers
          - mesa-filesystem
          - mesa-libEGL
          - mesa-libGL
          - mesa-libgbm
          - mesa-va-drivers
          - mesa-vulkan-drivers
    
  - type: script
    scripts:
      - replace-kernel.sh
      - install-cosign.sh
